/*! maska v2.0.1 | (c) Alexander Shabunevich | Released under the MIT license */
(function(l,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(l=typeof globalThis<"u"?globalThis:l||self,h(l.Maska={}))})(this,function(l){"use strict";var V=Object.defineProperty;var I=(l,h,d)=>h in l?V(l,h,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[h]=d;var m=(l,h,d)=>(I(l,typeof h!="symbol"?h+"":h,d),d);const h={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class d{constructor(e={}){m(this,"mask","");m(this,"tokens",h);m(this,"eager",!1);m(this,"reversed",!1);m(this,"memo",new Map);var t;if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...h,...e.tokens};for(const s of Object.values(e.tokens))typeof s.pattern=="string"&&(s.pattern=new RegExp(s.pattern))}e.mask==null?e.mask="":typeof e.mask=="object"&&(e.mask.length>1?e.mask.sort((s,n)=>s.length-n.length):e.mask=(t=e.mask[0])!=null?t:""),Object.assign(this,e)}masked(e){return this.process(e,this.findMask(e))}unmasked(e){return this.process(e,this.findMask(e),!1)}completed(e){const t=this.process(e,this.findMask(e)).length;return typeof this.mask=="string"?t>=this.mask.length:typeof this.mask=="function"?t>=this.findMask(e).length:this.mask.filter(s=>t>=s.length).length===this.mask.length}findMask(e){var s,n;if(typeof this.mask=="string")return this.mask;if(typeof this.mask=="function")return this.mask(e);const t=this.process(e,(s=this.mask.slice(-1).pop())!=null?s:"",!1);return(n=this.mask.find(a=>this.process(e,a,!1).length>=t.length))!=null?n:""}escapeMask(e){const t=[],s=[];return e.split("").forEach((n,a)=>{n==="!"&&e[a-1]!=="!"?s.push(a-s.length):t.push(n)}),{mask:t.join(""),escaped:s}}process(e,t,s=!0){var P;const n=`value=${e},mask=${t},masked=${s?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:a,escaped:k}=this.escapeMask(t),c=[],r=this.reversed?-1:1,g=this.reversed?"unshift":"push",y=this.reversed?0:a.length-1,O=this.reversed?()=>i>-1&&f>-1:()=>i<a.length&&f<e.length,C=u=>!this.reversed&&u<=y||this.reversed&&u>=y;let T,M=-1,i=this.reversed?a.length-1:0,f=this.reversed?e.length-1:0;for(;O();){const u=a.charAt(i),p=this.tokens[u],E=(p==null?void 0:p.transform)!=null?p.transform(e.charAt(f)):e.charAt(f);if(!k.includes(i)&&p!=null){if(E.match(p.pattern)!=null)c[g](E),p.repeated?(M===-1?M=i:i===y&&i!==M&&(i=M-r),y===M&&(i-=r)):p.multiple&&(i-=r),i+=r;else if(p.multiple){const L=((P=c[f-r])==null?void 0:P.match(p.pattern))!=null,R=a.charAt(i+r);L&&R!==""&&this.tokens[R]==null?(i+=r,f-=r):c[g]("")}else E===T?T=void 0:p.optional&&(i+=r,f-=r);f+=r}else s&&!this.eager&&c[g](u),E===u&&!this.eager?f+=r:T=u,this.eager||(i+=r);if(this.eager)for(;C(i)&&(this.tokens[a.charAt(i)]==null||k.includes(i));)s?c[g](a.charAt(i)):a.charAt(i)===e.charAt(f)&&(f+=r),i+=r}return this.memo.set(n,c.join("")),this.memo.get(n)}}const b=o=>JSON.parse(o.replaceAll("'",'"')),A=o=>o!==""?Boolean(JSON.parse(o)):!0,S=o=>o.startsWith("[")&&o.endsWith("]")?b(o):o,W=o=>{if(o.startsWith("{")&&o.endsWith("}"))return b(o);const e={};return o.split("|").forEach(t=>{const s=t.split(":");e[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),e};class w{constructor(e,t={}){m(this,"items",new Map);m(this,"beforeinputEvent",e=>{const t=e.target,s=this.items.get(t);s.eager&&"inputType"in e&&e.inputType.startsWith("delete")&&s.unmasked(t.value).length<=1&&this.setMaskedValue(t,"")});m(this,"inputEvent",e=>{const t=e.target,s=this.items.get(t),n=t.value,a=t.selectionStart,k=t.selectionEnd;let c=n;if(s.eager){const r=s.unmasked(n),g=s.masked(r);r===""&&"data"in e&&e.data!=null?c=e.data:(g.startsWith(n)||s.completed(r))&&(c=r)}this.setMaskedValue(t,c),"inputType"in e&&(e.inputType.startsWith("delete")||a!=null&&a<n.length)&&t.setSelectionRange(a,k)});this.options=t;const{onMaska:s,preProcess:n,postProcess:a,...k}=t;typeof e=="string"?this.init(Array.from(document.querySelectorAll(e)),k):this.init("length"in e?Array.from(e):[e],k)}destroy(){for(const e of this.items.keys())e.removeEventListener("input",this.inputEvent),e.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}init(e,t){for(const s of e){const n={...t};s.dataset.maska!=null&&s.dataset.maska!==""&&(n.mask=S(s.dataset.maska)),s.dataset.maskaEager!=null&&(n.eager=A(s.dataset.maskaEager)),s.dataset.maskaReversed!=null&&(n.reversed=A(s.dataset.maskaReversed)),s.dataset.maskaTokensReplace!=null&&(n.tokensReplace=A(s.dataset.maskaTokensReplace)),s.dataset.maskaTokens!=null&&(n.tokens=W(s.dataset.maskaTokens));const a=new d(n);this.items.set(s,a),s.value!==""&&this.setMaskedValue(s,s.value),s.addEventListener("input",this.inputEvent),s.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(e,t){const s=this.items.get(e);this.options.preProcess!=null&&(t=this.options.preProcess(t)),t=s.masked(t),this.options.postProcess!=null&&(t=this.options.postProcess(t)),e.value=t;const n={masked:s.masked(t),unmasked:s.unmasked(t),completed:s.completed(t)};this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(a=>a(n)):this.options.onMaska(n)),e.dispatchEvent(new CustomEvent("maska",{detail:n}))}}const v=new WeakMap,j=(o,e)=>{var n;const t=o instanceof HTMLInputElement?o:o.querySelector("input");if(t==null)return;v.get(t)!=null&&((n=v.get(t))==null||n.destroy());const s={...e.arg};if(e.value!=null){const a=e.value,k=c=>{a.masked=c.masked,a.unmasked=c.unmasked,a.completed=c.completed};s.onMaska=s.onMaska==null?k:Array.isArray(s.onMaska)?[...s.onMaska,k]:[s.onMaska,k]}v.set(t,new w(t,s))};l.Mask=d,l.MaskInput=w,l.tokens=h,l.vMaska=j,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
